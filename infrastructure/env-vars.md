# Environment Variables Reference

Complete reference for every environment variable used across the Matrx server infrastructure.

---

## Bootstrap Variables (`.env.bootstrap`)

Used only during initial server provisioning via `bootstrap.sh`.

| Variable | Required | Description | Example |
|----------|----------|-------------|---------|
| `DOMAIN` | Yes | Base domain for all services | `dev.codematrx.com` |
| `TRAEFIK_DASHBOARD_AUTH` | Yes | htpasswd-encoded credentials for Traefik dashboard | `admin:$$2y$$05$$...` |
| `POSTGRES_USER` | Yes | Shared PostgreSQL superuser | `matrx` |
| `POSTGRES_PASSWORD` | Yes | Shared PostgreSQL password | (generated) |
| `POSTGRES_DB` | Yes | Default database name | `matrx` |
| `PGADMIN_EMAIL` | Yes | pgAdmin login email | `admin@matrxserver.com` |
| `PGADMIN_PASSWORD` | Yes | pgAdmin login password | (generated) |
| `MANAGER_BEARER_TOKEN` | Yes | Auth token for Server Manager | `openssl rand -hex 32` |
| `AWS_ACCESS_KEY_ID` | Yes | AWS IAM access key for S3 backups | `AKIA...` |
| `AWS_SECRET_ACCESS_KEY` | Yes | AWS IAM secret key | (from AWS) |
| `AWS_DEFAULT_REGION` | Yes | AWS region | `us-east-1` |
| `S3_BACKUP_BUCKET` | Yes | S3 bucket for backups | `matrx-server-backups-prod` |
| `GITHUB_REPO_URL` | Yes | matrx-ship Git clone URL | `https://github.com/.../matrx-ship.git` |
| `SANDBOX_REPO_URL` | No | matrx-sandbox Git clone URL | `https://github.com/.../matrx-sandbox.git` |
| `MCP_TEMPLATE_REPO_URL` | No | matrx-mcp-template Git clone URL | `https://github.com/.../matrx-mcp-template.git` |

---

## Traefik (`/srv/traefik/.env`)

| Variable | Description |
|----------|-------------|
| `DOMAIN` | Base domain (used in Traefik labels) |
| `TRAEFIK_DASHBOARD_AUTH` | htpasswd-encoded basic auth for dashboard |

---

## PostgreSQL (`/srv/postgres/.env`)

| Variable | Description |
|----------|-------------|
| `POSTGRES_USER` | Database superuser name |
| `POSTGRES_PASSWORD` | Database superuser password |
| `POSTGRES_DB` | Default database name |
| `PGADMIN_EMAIL` | pgAdmin admin email |
| `PGADMIN_PASSWORD` | pgAdmin admin password |

---

## Server Manager (`/srv/apps/server-manager/.env`)

| Variable | Description |
|----------|-------------|
| `MANAGER_BEARER_TOKEN` | Bearer token for API/MCP authentication (also accepts legacy `MCP_BEARER_TOKEN`) |
| `AWS_ACCESS_KEY_ID` | AWS access key for S3 backup operations |
| `AWS_SECRET_ACCESS_KEY` | AWS secret key |
| `AWS_DEFAULT_REGION` | AWS region |
| `S3_BACKUP_BUCKET` | S3 bucket name |
| `NODE_ENV` | Set to `production` (via docker-compose environment) |

---

## Deploy Server (`/srv/apps/deploy/.env`)

| Variable | Description |
|----------|-------------|
| `AWS_ACCESS_KEY_ID` | AWS access key for S3 backup operations |
| `AWS_SECRET_ACCESS_KEY` | AWS secret key |
| `AWS_DEFAULT_REGION` | AWS region |
| `S3_BACKUP_BUCKET` | S3 bucket name |
| `NODE_ENV` | Set to `production` (via docker-compose environment) |
| `HOST_SRV_PATH` | Path to mounted /srv inside container (default: `/host-srv`) |

---

## Ship App Instances (`/srv/apps/{name}/.env`)

Auto-generated by the Server Manager when creating instances.

| Variable | Description |
|----------|-------------|
| `POSTGRES_PASSWORD` | Per-instance database password (auto-generated) |
| `PROJECT_NAME` | Display name for the project |
| `MATRX_SHIP_API_KEY` | API key for CLI authentication (auto-generated) |
| `MATRX_SHIP_ADMIN_SECRET` | Admin secret (optional) |
| `VERCEL_ACCESS_TOKEN` | Vercel integration token (optional) |
| `VERCEL_PROJECT_ID` | Vercel project ID (optional) |
| `VERCEL_TEAM_ID` | Vercel team ID (optional) |
| `VERCEL_WEBHOOK_SECRET` | Vercel webhook verification secret (optional) |
| `GITHUB_WEBHOOK_SECRET` | GitHub webhook verification secret (optional) |

---

## CLI / Local Development

These variables are set in the developer's local environment or `.matrx.json` config.

| Variable | Description | Default |
|----------|-------------|---------|
| `MATRX_SHIP_SERVER` | Server Manager URL | `https://manager.dev.codematrx.com` |
| `MATRX_SHIP_SERVER_TOKEN` | Bearer token for server API | (from Server Manager) |
| `MATRX_SHIP_URL` | Override instance URL | (from `.matrx.json`) |
| `MATRX_SHIP_API_KEY` | Override instance API key | (from `.matrx.json`) |

---

## Security Notes

- Never commit `.env` files with real secrets to source control
- All `.env` files on the server should be `chmod 600`
- Use `openssl rand -hex 32` to generate secure tokens
- Rotate `MANAGER_BEARER_TOKEN` periodically via the tokens API
- AWS credentials should use a dedicated IAM user with minimal permissions (S3 only)
